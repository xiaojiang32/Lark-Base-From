# 飞书多维表格表单生成器

## 一、产品概述

### 1.1 产品定位
一款「低代码、可视化、可嵌入」的表单生成器，专为飞书多维表格（Lark Base）仪表板设计，允许非研发角色快速拼装出可投产表单。

### 1.2 目标用户
- **运营人员**：快速创建活动报名表、用户调研表
- **产品经理**：原型验证、需求收集表
- **客服人员**：工单录入、问题反馈表
- **其他非研发角色**：5 分钟内拼装出可投产表单

### 1.3 核心价值
- **低代码**：拖拽式配置，无需编写代码
- **可视化**：左侧实时预览，右侧属性配置
- **可嵌入**：无缝嵌入飞书多维表格视图
- **快速上手**：5 分钟内完成表单搭建
- **实时生效**：配置变动 ≤ 200ms 内同步到预览区
- **高度定制**：支持 7 种原子组件，灵活组合

### 1.4 适用场景
- **数据收集**：用户反馈、问卷调查、信息登记
- **活动报名**：活动报名、课程注册
- **工单系统**：问题反馈、工单创建
- **审批流程**：审批申请、表单提交
- **快速录入**：标准化数据录入到多维表格

## 二、信息架构（IA）

```
┌─────────────────────────────┬─────────────────────┐
│                             │  属性配置面板       │
│   实时预览区                 │                     │
│   （表单效果实时展示）       │  [顶部 Tab]         │
│                             │                     │
│   ┌─────────────────────┐   │  [组件库]           │
│   │  表单标题           │   │    - 输入框         │
│   │  表单描述           │   │    - 按钮           │
│   ├─────────────────────┤   │    - 折叠按钮组     │
│   │  字段1              │   │    - 下拉选择       │
│   │  字段2              │   │    - 下拉多选       │
│   │  字段3              │   │    - 日期选择器     │
│   ├─────────────────────┤   │    - 时间选择器     │
│   │  提交按钮           │   │    - 日期时间选择器 │
│   └─────────────────────┘   │                     │
│                             │  [字段级属性]       │
│                             │    - 表单项标识     │
│                             │    - 标题           │
│                             │    - 占位文本       │
│                             │    - ...            │
└─────────────────────────────┴─────────────────────┘
```

### 2.1 左侧实时预览区
- **卡片容器**：表单外层容器，支持边框、阴影、圆角、背景色配置
- **分组标题**：表单标题和描述，支持显示/隐藏
- **表单域**：根据配置动态渲染的表单字段
- **提交按钮**：表单提交按钮，支持多种样式

### 2.2 右侧属性配置面板
- **顶部 Tab**：切换不同配置视图（表单配置 / 字段配置）
- **组件库**：7 种原子组件，点击即插入默认实例
- **字段级属性**：选中字段的详细配置项

## 三、组件库

### 3.1 输入框（Input）
**功能描述**：单行文本输入框，用于收集短文本信息

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单项标识 | string | Input_随机8位 | 字母数字下划线，全局唯一 | ✔ |
| 标题 | string | 空 | 最多 30 字，可隐藏 | ✔ |
| 占位文本 | string | 请输入 | 最多 100 字 | ✔ |
| 默认文本 | string | 空 | 提交时若用户未输入则采用 | ✔ |
| 最大文本长度 | number | 200 | 0=不限；>0 时右下角显示计数 | ✔ |
| 宽度模式 | select | 自适应 | 自适应 / 固定 / 填满 | ✔ |
| 是否必填 | switch | 关 | 开=出现红色星号 & 校验 | ✔ |
| 校验规则 | array | [] | 手机号 / 邮箱 / 正则 / 自定义 | ✔ |
| 错误提示 | string | 请输入正确内容 | 校验失败时底部红字 | ✔ |

**查看模式**：
- 显示标题标签（必填项显示红色星号）
- 显示输入框，支持实时字数统计
- 失焦触发格式校验
- 校验失败时显示错误提示

### 3.2 按钮（Button）
**功能描述**：表单提交按钮，用于提交表单数据

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 按钮文本 | string | 提交 | 最多 20 字 | ✔ |
| 按钮样式 | select | primary | primary / secondary / warning / danger | ✔ |
| 按钮大小 | select | medium | small / medium / large | ✔ |
| 提交成功提示 | string | 提交成功 | 最多 50 字 | ✔ |
| 提交后操作 | select | keep | reset / disable / keep | ✔ |
| 二次确认 | switch | 关 | 提交前弹出确认对话框 | ✔ |
| 确认对话框文本 | string | 确认提交？ | 最多 100 字 | ✔ |

**查看模式**：
- 显示按钮，样式和文本根据配置
- 点击后执行提交逻辑
- 显示加载状态（提交中）
- 显示成功/失败提示

### 3.3 折叠按钮组（Collapse Button Group）
**功能描述**：可折叠的按钮组，支持单选或多选

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单项标识 | string | Collapse_随机8位 | 字母数字下划线，全局唯一 | ✔ |
| 标题 | string | 空 | 最多 30 字，可隐藏 | ✔ |
| 选项列表 | array | [] | 支持动态选项绑定远程接口 | ✔ |
| 展开方向 | select | 下 | 下 / 右 / 上 / 左 | ✔ |
| 最多选中数量 | number | 1 | 1=单选，>1=多选，0=不限 | ✔ |
| 是否必填 | switch | 关 | 开=出现红色星号 & 校验 | ✔ |
| 错误提示 | string | 请选择选项 | 校验失败时底部红字 | ✔ |

**动态选项数据格式**：
```typescript
{
  label: string;
  value: string;
  icon?: string; // 图标 URL
}
```

**查看模式**：
- 显示标题标签（必填项显示红色星号）
- 显示折叠按钮组，支持展开/收起
- 点击选项进行选择
- 支持图标显示

### 3.4 下拉选择（Select）
**功能描述**：下拉单选框，用于从预设选项中选择一个

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单项标识 | string | Select_随机8位 | 字母数字下划线，全局唯一 | ✔ |
| 标题 | string | 空 | 最多 30 字，可隐藏 | ✔ |
| 占位文本 | string | 请选择 | 最多 100 字 | ✔ |
| 选项列表 | array | [] | 支持动态选项绑定远程接口 | ✔ |
| 默认选中 | string | 空 | 默认选中的选项值 | ✔ |
| 是否必填 | switch | 关 | 开=出现红色星号 & 校验 | ✔ |
| 错误提示 | string | 请选择选项 | 校验失败时底部红字 | ✔ |

**查看模式**：
- 显示标题标签（必填项显示红色星号）
- 显示下拉框，点击展开选项
- 支持搜索过滤选项
- 支持图标显示

### 3.5 下拉多选（Multi Select）
**功能描述**：下拉多选框，用于从预设选项中选择多个

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单项标识 | string | MultiSelect_随机8位 | 字母数字下划线，全局唯一 | ✔ |
| 标题 | string | 空 | 最多 30 字，可隐藏 | ✔ |
| 占位文本 | string | 请选择 | 最多 100 字 | ✔ |
| 选项列表 | array | [] | 支持动态选项绑定远程接口 | ✔ |
| 默认选中 | array | [] | 默认选中的选项值数组 | ✔ |
| 最少选择数 | number | 0 | 最少选择数量 | ✔ |
| 最多选择数 | number | 0 | 0=不限，>0 时限制最多选择 | ✔ |
| 是否必填 | switch | 关 | 开=出现红色星号 & 校验 | ✔ |
| 错误提示 | string | 请至少选择一项 | 校验失败时底部红字 | ✔ |

**查看模式**：
- 显示标题标签（必填项显示红色星号）
- 显示下拉框，点击展开选项
- 支持搜索过滤选项
- 支持全选/取消全选
- 显示已选数量

### 3.6 日期选择器（Date Picker）
**功能描述**：日期选择框，用于选择日期

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单项标识 | string | Date_随机8位 | 字母数字下划线，全局唯一 | ✔ |
| 标题 | string | 空 | 最多 30 字，可隐藏 | ✔ |
| 占位文本 | string | 请选择日期 | 最多 100 字 | ✔ |
| 默认日期 | string | 空 | YYYY-MM-DD 格式 | ✔ |
| 日期格式 | select | YYYY-MM-DD | YYYY-MM-DD / MM/DD/YYYY / DD/MM/YYYY | ✔ |
| 最小日期 | string | 空 | YYYY-MM-DD 格式 | ✔ |
| 最大日期 | string | 空 | YYYY-MM-DD 格式 | ✔ |
| 是否必填 | switch | 关 | 开=出现红色星号 & 校验 | ✔ |
| 错误提示 | string | 请选择日期 | 校验失败时底部红字 | ✔ |

**查看模式**：
- 显示标题标签（必填项显示红色星号）
- 显示日期选择框
- 点击弹出日期选择器
- 支持快捷选择（今天、昨天、本周等）

### 3.7 时间选择器（Time Picker）
**功能描述**：时间选择框，用于选择时间

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单项标识 | string | Time_随机8位 | 字母数字下划线，全局唯一 | ✔ |
| 标题 | string | 空 | 最多 30 字，可隐藏 | ✔ |
| 占位文本 | string | 请选择时间 | 最多 100 字 | ✔ |
| 默认时间 | string | 空 | HH:mm 格式 | ✔ |
| 时间格式 | select | HH:mm | HH:mm / HH:mm:ss | ✔ |
| 最小时间 | string | 空 | HH:mm 格式 | ✔ |
| 最大时间 | string | 空 | HH:mm 格式 | ✔ |
| 时间间隔 | number | 30 | 分钟间隔，1-60 | ✔ |
| 是否必填 | switch | 关 | 开=出现红色星号 & 校验 | ✔ |
| 错误提示 | string | 请选择时间 | 校验失败时底部红字 | ✔ |

**查看模式**：
- 显示标题标签（必填项显示红色星号）
- 显示时间选择框
- 点击弹出时间选择器
- 支持快捷选择（现在、整点等）

### 3.8 日期时间选择器（DateTime Picker）
**功能描述**：日期时间选择框，用于选择日期和时间

**配置项**：

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单项标识 | string | DateTime_随机8位 | 字母数字下划线，全局唯一 | ✔ |
| 标题 | string | 空 | 最多 30 字，可隐藏 | ✔ |
| 占位文本 | string | 请选择日期时间 | 最多 100 字 | ✔ |
| 默认日期时间 | string | 空 | YYYY-MM-DD HH:mm 格式 | ✔ |
| 日期格式 | select | YYYY-MM-DD | YYYY-MM-DD / MM/DD/YYYY / DD/MM/YYYY | ✔ |
| 时间格式 | select | HH:mm | HH:mm / HH:mm:ss | ✔ |
| 最小日期时间 | string | 空 | YYYY-MM-DD HH:mm 格式 | ✔ |
| 最大日期时间 | string | 空 | YYYY-MM-DD HH:mm 格式 | ✔ |
| 时间间隔 | number | 30 | 分钟间隔，1-60 | ✔ |
| 是否必填 | switch | 关 | 开=出现红色星号 & 校验 | ✔ |
| 错误提示 | string | 请选择日期时间 | 校验失败时底部红字 | ✔ |

**查看模式**：
- 显示标题标签（必填项显示红色星号）
- 显示日期时间选择框
- 点击弹出日期时间选择器
- 支持快捷选择（现在、今天、明天等）

## 四、表单全局配置

### 4.1 基础配置

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 表单标题 | string | 空 | 最多 50 字，可隐藏 | ✔ |
| 表单描述 | string | 空 | 最多 200 字，可隐藏 | ✔ |
| 表单宽度 | select | standard | narrow / standard / wide / full | ✔ |
| 表单对齐 | select | center | left / center / right | ✔ |
| 字段间距 | number | 16 | 8-32px | ✔ |

### 4.2 样式配置

| 属性名 | 类型 | 默认值 | 可选值 / 规则 | 实时生效 |
|--------|------|--------|---------------|----------|
| 显示边框 | switch | 开 | 是否显示表单边框 | ✔ |
| 显示阴影 | switch | 开 | 是否显示表单阴影 | ✔ |
| 背景颜色 | color | #FFFFFF | 颜色选择器 | ✔ |
| 圆角大小 | number | 8 | 0-16px | ✔ |
| 边框颜色 | color | #E5E5E5 | 颜色选择器 | ✔ |
| 边框宽度 | number | 1 | 0-4px | ✔ |

## 五、运行时能力

### 5.1 校验流

#### 5.1.1 失焦校验
- **触发时机**：用户输入完成后失焦
- **校验内容**：格式校验（手机号、邮箱、正则等）
- **反馈方式**：字段底部显示红色错误提示

#### 5.1.2 全局校验
- **触发时机**：点击提交按钮
- **校验内容**：所有字段的必填校验和格式校验
- **反馈方式**：
  - 校验失败自动滚动到第一个错误项
  - 聚焦到错误字段
  - 显示错误提示

### 5.2 数据流

采用单向数据流：

```
用户输入 → 组件内部 state → onChange → 表单级 JSON → 统一提交
```

#### 5.2.1 提交 Payload 示例

```typescript
{
  "Input_3bej1nmttrxz": "张三",
  "Select_abc123": "shanghai",
  "Date_xyz789": "2026-01-22",
  "MultiSelect_def456": ["option1", "option2"],
  "Time_ghi789": "14:30",
  "DateTime_jkl012": "2026-01-22 14:30",
  "Collapse_mno345": ["option1"]
}
```

### 5.3 事件钩子（供嵌入方）

| 钩子名 | 触发时机 | 参数 | 可阻断提交 |
|--------|----------|------|-----------|
| onMount | 表单渲染完成 | {form} | — |
| onChange | 任一字段变化 | {id, value, form} | — |
| onValidate | 校验结束 | {errors[]} | 返回 false=阻断 |
| onSubmit | 点击提交 & 校验通过 | {values} | 返回 false=阻断 |
| onError | 校验或接口返回错误 | {errors[]} | — |

#### 5.3.1 使用示例

```typescript
// 表单挂载
form.onMount(({ form }) => {
  console.log('表单已加载', form);
});

// 字段变化
form.onChange(({ id, value, form }) => {
  console.log(`字段 ${id} 变为 ${value}`);
});

// 校验拦截
form.onValidate(({ errors }) => {
  if (errors.length > 0) {
    console.log('校验失败', errors);
  }
  return true; // 返回 false 可阻断提交
});

// 提交拦截
form.onSubmit(({ values }) => {
  console.log('提交数据', values);
  return true; // 返回 false 可阻断提交
});
```

## 六、性能指标

### 6.1 渲染性能
- **首次渲染**：< 200ms（本地 benchmark）
- **字段更新**：< 50ms（单个字段配置变更）
- **表单更新**：< 100ms（全局配置变更）

### 6.2 交互性能
- **100 字段级表单**：交互无卡顿
- **技术方案**：React + React-hook-form + 虚拟滚动

### 6.3 构建性能
- **导出 Schema**：≤ 5 KB（gzip）
- **打包体积**：≤ 200 KB（gzip）

## 七、可访问性（a11y）

### 7.1 键盘操作
- **全部组件键盘可达**：Tab 顺序与视觉顺序一致
- **快捷键支持**：
  - Enter：提交表单
  - Escape：取消操作
  - Space：选中/取消选中

### 7.2 屏幕阅读器
- **aria-label**：由「标题 + 占位文本」自动拼接
- **aria-required**：必填字段自动添加
- **aria-invalid**：校验失败时自动添加

### 7.3 色彩对比
- **主文字**：#262626 对背景 #FFFFFF 对比度 15.3:1，超过 WCAG 2.1 AAA
- **次级文字**：#8C8C8C 对背景 #FFFFFF 对比度 4.5:1，符合 WCAG 2.1 AA
- **错误提示**：#F5222D 对背景 #FFFFFF 对比度 4.5:1，符合 WCAG 2.1 AA

## 八、国际化（i18n）

### 8.1 文案 key 化
- **示例**：`placeholder` → `form.input.placeholder`
- **规则**：所有用户可见文本均需 key 化

### 8.2 支持语言
- **zh-CN**：简体中文
- **en-US**：英语（美国）
- **ja-JP**：日语

### 8.3 自动切换
- **检测方式**：根据浏览器语言自动切换
- **手动切换**：支持用户手动选择语言

### 8.4 日期时间格式
- **zh-CN**：YYYY-MM-DD HH:mm
- **en-US**：MM/DD/YYYY HH:mm
- **ja-JP**：YYYY/MM/DD HH:mm

## 九、技术架构

### 9.1 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18.3.1 | 前端框架 |
| TypeScript | 5.9.3 | 类型系统 |
| Vite | 5.4.21 | 构建工具 |
| Semi UI | 2.90.13 | UI 组件库（飞书设计系统）|
| @lark-base-open/js-sdk | 0.4.1-beta.5 | 飞书多维表格 SDK |
| i18next | 23.16.8 | 国际化 |
| react-hook-form | 7.x | 表单管理 |
| pnpm | 10.28.1 | 包管理器 |
| sass | 1.97.2 | CSS 预处理器 |

### 9.2 项目结构

```
Count-Down/
├── dist/                    # 构建输出目录
├── public/                  # 静态资源
├── src/
│   ├── components/          # 组件目录
│   │   ├── Form/           # 表单组件
│   │   │   ├── index.tsx    # 主组件
│   │   │   ├── style.scss   # 样式文件
│   │   │   ├── fields/     # 字段组件
│   │   │   │   ├── Input/          # 输入框
│   │   │   │   ├── Button/         # 按钮
│   │   │   │   ├── CollapseGroup/  # 折叠按钮组
│   │   │   │   ├── Select/         # 下拉选择
│   │   │   │   ├── MultiSelect/    # 下拉多选
│   │   │   │   ├── DatePicker/     # 日期选择器
│   │   │   │   ├── TimePicker/     # 时间选择器
│   │   │   │   └── DateTimePicker/ # 日期时间选择器
│   │   │   └── config/     # 配置面板
│   │   │       ├── GlobalConfigPanel/    # 全局配置
│   │   │       ├── FieldConfigPanel/     # 字段配置
│   │   │       └── ComponentLibrary/     # 组件库
│   │   ├── Item/            # 表单项组件
│   │   └── LoadApp/         # 应用加载器
│   ├── locales/             # 国际化文件
│   │   ├── i18n.ts          # i18n 配置
│   │   ├── zh.json          # 中文
│   │   ├── en.json          # 英文
│   │   └── jp.json          # 日文
│   ├── App.tsx              # 根组件
│   ├── App.scss             # 全局样式（主题变量）
│   ├── hooks.ts             # 自定义 Hooks
│   ├── types.ts             # 类型定义
│   ├── utils.ts             # 工具函数
│   └── index.tsx            # 入口文件
├── index.html               # HTML 模板
├── vite.config.js           # Vite 配置
├── tsconfig.json            # TypeScript 配置
└── package.json             # 项目配置
```

## 十、后续迭代方向（Roadmap）

### 10.1 条件显示
- **功能描述**：字段 A 选中"其它"时才显示字段 B
- **使用场景**：动态表单、条件逻辑
- **实现方式**：支持配置字段间的依赖关系

### 10.2 分页 / 步骤条
- **功能描述**：长表单分步填写
- **使用场景**：复杂表单、多步骤流程
- **实现方式**：支持表单分页和步骤条导航

### 10.3 主题皮肤
- **功能描述**：一键换色，适配品牌 VI
- **使用场景**：品牌定制、视觉统一
- **实现方式**：支持自定义主题色和样式

### 10.4 协同编辑
- **功能描述**：多人在线同时编辑同一份表单
- **使用场景**：团队协作、实时编辑
- **实现方式**：OT 算法（Operational Transformation）

### 10.5 数据联动
- **功能描述**：字段间数据联动和计算
- **使用场景**：动态计算、数据关联
- **实现方式**：支持字段间的计算公式

### 10.6 模板库
- **功能描述**：预设常用表单模板
- **使用场景**：快速创建、标准化表单
- **实现方式**：提供多种场景的表单模板

## 十一、构建与部署

### 11.1 构建命令

```bash
# 开发模式
pnpm dev

# 生产构建
pnpm build

# 预览构建结果
pnpm preview
```

### 11.2 部署说明
- **构建产物**：部署前需运行 `pnpm run build` 生成部署产物
- **部署目录**：package.json 中的 output 字段指定了部署的目录
- **相对路径**：Vite 配置使用 `base: "./"`，确保在任何环境下都能正常加载

## 十二、开发指南

### 12.1 添加新字段类型

1. 在 `src/types.ts` 中定义新字段类型接口
2. 在 `src/components/Form/fields/` 下创建新字段组件
3. 在组件库中添加新字段的入口
4. 在配置面板中添加新字段的配置选项
5. 更新国际化文件

### 12.2 添加新校验规则

1. 在 `src/utils.ts` 中添加校验函数
2. 在 `useFormValidation` hook 中集成新校验规则
3. 更新错误提示的国际化文本

### 12.3 添加新事件钩子

1. 在 `src/hooks.ts` 中定义新钩子接口
2. 在表单组件中实现钩子调用逻辑
3. 更新文档说明钩子的使用方式

## 十三、总结

表单生成器是一个功能强大、易于使用的低代码表单构建工具。它提供了直观的可视化界面，支持 7 种原子组件，能够满足各种数据收集场景的需求。

**核心优势**：
- 低代码：拖拽式配置，无需编写代码
- 可视化：左侧实时预览，右侧属性配置
- 可嵌入：无缝嵌入飞书多维表格视图
- 快速上手：5 分钟内完成表单搭建
- 实时生效：配置变动 ≤ 200ms 内同步到预览区
- 高度定制：支持 7 种原子组件，灵活组合
- 性能优异：首次渲染 < 200ms，100 字段无卡顿
- 可访问性：符合 WCAG 2.1 AAA 标准
- 国际化：支持中文、英文、日文

**一句话总结**：
「把右侧属性面板当成 Excel 公式栏，把左侧卡片当成实时预览，就能把任何表单需求在 5 分钟内「画」出来。」

该项目可以作为飞书插件开发的参考案例，为其他低代码组件的开发提供借鉴。
