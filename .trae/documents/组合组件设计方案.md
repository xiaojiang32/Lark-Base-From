# 组合组件设计方案

## 1. 核心功能

* 组合组件（Composite Component）可容纳其他组件

* 支持配置子组件宽度占比（如 1:1:1、2:1、自适应）

* 最多支持放入 4 个组件（全宽模式下支持 8 个）

* 不允许嵌套组合组件

* 默认宽度铺满表单宽度

* 可替代现有两列布局，支持 3 列及以上布局

## 2. 技术设计

### 2.1 类型定义（`src/types.ts`）

* 在 `IFormField['type']` 中添加 `'composite'` 类型

* 创建 `ICompositeField` 接口，扩展 `IFormField`：

  ```typescript
  export interface ICompositeField extends IFormField {
    type: 'composite';
    children: string[]; // 子组件 ID 数组
    widthRatios: string; // 宽度比例字符串，如 "1:1:1"
    maxChildren: number; // 最大子组件数（4 或 8）
  }
  ```

### 2.2 组件注册（`ComponentLibrary/index.tsx`）

* 在组件库中添加组合组件：

  ```typescript
  {
    type: 'composite',
    name: '组合组件',
    icon: '📦',
    description: '组合其他组件，支持多列布局',
    defaultConfig: {
      type: 'composite',
      name: '组合组件',
      required: false,
      order: 0,
      children: [],
      widthRatios: '1:1',
      maxChildren: 4
    }
  }
  ```

### 2.3 组合组件实现（`fields/CompositeField/index.tsx`）

* 创建组合组件，负责：

  * 渲染子组件

  * 应用宽度比例样式

  * 从 `config.fields` 获取子组件数据

### 2.4 配置面板（`FieldConfigPanel/index.tsx`）

* 添加 `renderCompositeFieldConfig` 函数：

  * 支持添加/移除子组件

  * 配置宽度比例

  * 验证子组件数量限制

  * 防止嵌套组合组件

### 2.5 Form 组件更新（`Form/index.tsx`）

* 更新 `renderField` 处理 `'composite'` 类型

* 更新 `handleAddField` 支持组合组件子组件

* 添加禁止嵌套组合组件的逻辑

* 考虑移除两列布局支持

### 2.6 工具函数（`utils.ts`）

* 添加解析宽度比例的工具函数

* 添加组合组件约束验证

## 3. 关键实现细节

### 3.1 宽度比例处理

* 存储比例为字符串（如 "1:1:1"）

* 解析为数字数组

* 转换为 CSS Grid 列（如 "1fr 1fr 1fr"）

### 3.2 子组件管理

* 通过 ID 数组 `children` 跟踪子组件

* 从 `config.fields` 中查找实际子组件对象

* 验证子组件类型（禁止组合组件嵌套）

### 3.3 布局实现

* 使用 CSS Grid 实现精确宽度控制

* 根据 `widthRatios` 设置 `grid-template-columns`

* 自适应不同表单宽度

### 3.4 验证逻辑

* 限制子组件数量（4/8）

* 禁止嵌套组合组件

* 验证宽度比例格式

## 4. 使用流程

1. 用户添加组合组件
2. 配置组合组件，添加子组件
3. 设置子组件宽度比例
4. 组合组件按配置渲染子组件

## 5. 替代两列布局

* 组合组件可实现任意列数布局

* 建议移除原两列布局，简化代码

* 保持向后兼容性

## 6. 文件修改清单

* `src/types.ts` - 添加类型定义

* `src/components/Form/config/ComponentLibrary/index.tsx` - 注册组合组件

* `src/components/Form/fields/CompositeField/index.tsx` - 实现组合组件

* `src/components/Form/config/FieldConfigPanel/index.tsx` - 添加配置面板

* `src/components/Form/index.tsx` - 更新表单逻辑

* \`src/utils.ts

